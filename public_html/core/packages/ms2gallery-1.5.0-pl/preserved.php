<?php return array (
  'ed14fab68cd72f5423eb4ceac58c1001' => 
  array (
    'criteria' => 
    array (
      'name' => 'ms2gallery',
    ),
    'object' => 
    array (
      'name' => 'ms2gallery',
      'path' => '{core_path}components/ms2gallery/',
      'assets_path' => '',
    ),
  ),
  '2eee21c09765cb605e390956ac1cb2be' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_duplicate_check',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_duplicate_check',
      'value' => '1',
      'xtype' => 'combo-boolean',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  '37ef6d5923ae6044b344a7d31bc6097a' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_exact_sorting',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_exact_sorting',
      'value' => '1',
      'xtype' => 'combo-boolean',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  'db7d5d6437e75775102411806cf47b58' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_source_default',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_source_default',
      'value' => '3',
      'xtype' => 'modx-combo-source',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => '2017-07-30 21:08:23',
    ),
  ),
  '8ca4804c705c9910ee3b7277a518c6cd' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_date_format',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_date_format',
      'value' => '%d.%m.%y %H:%M',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  'beff15188612c28d6990e6704c6aa1c1' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_page_size',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_page_size',
      'value' => '50',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  '91a55450ad27fc041834329f51f53a67' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_disable_for_templates',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_disable_for_templates',
      'value' => '',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  'c0f1680dfe3842a82e64e5ac7c08f62b' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_new_tab_mode',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_new_tab_mode',
      'value' => '',
      'xtype' => 'combo-boolean',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  'af1169904a0482e33a4a6fdeb883505d' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_disable_for_ms2',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_disable_for_ms2',
      'value' => '1',
      'xtype' => 'combo-boolean',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_resource',
      'editedon' => NULL,
    ),
  ),
  '97d3ef873809dd3f7e934dc06e63d6c7' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_set_placeholders',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_set_placeholders',
      'value' => '',
      'xtype' => 'combo-boolean',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_frontend',
      'editedon' => NULL,
    ),
  ),
  'af0e5f68ce308abbaa1bf2e9c75b1bb7' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_placeholders_prefix',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_placeholders_prefix',
      'value' => 'ms2g.',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_frontend',
      'editedon' => NULL,
    ),
  ),
  '6d9f63cc4644a0820ed356749f6444d3' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_placeholders_tpl',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_placeholders_tpl',
      'value' => '',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_frontend',
      'editedon' => NULL,
    ),
  ),
  '3140de39e0c7285a8a26b1a5f4f48263' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_placeholders_for_templates',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_placeholders_for_templates',
      'value' => '',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_frontend',
      'editedon' => NULL,
    ),
  ),
  'e2a2ac10485dc949d94df694f6d718ee' => 
  array (
    'criteria' => 
    array (
      'key' => 'ms2gallery_placeholders_thumbs',
    ),
    'object' => 
    array (
      'key' => 'ms2gallery_placeholders_thumbs',
      'value' => '',
      'xtype' => 'textfield',
      'namespace' => 'ms2gallery',
      'area' => 'ms2gallery_frontend',
      'editedon' => NULL,
    ),
  ),
  '607222bec7befbea0000d6262cedaff0' => 
  array (
    'criteria' => 
    array (
      'category' => 'ms2Gallery',
    ),
    'object' => 
    array (
      'id' => 10,
      'parent' => 0,
      'category' => 'ms2Gallery',
      'rank' => 0,
    ),
  ),
  '6364acad03949310139ae50df7140853' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.ms2Gallery.row',
    ),
    'object' => 
    array (
      'id' => 36,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.ms2Gallery.row',
      'description' => '',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'snippet' => '<div class="span2 col-md-2">
	<a href="[[+360x270:default=`[[+url]]`]]" class="thumbnail" data-image="[[+url]]">
		<img src="[[+120x90]]" alt="[[+alt]]" title="[[+name]]" width="120" height="90">
	</a>
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/chunks/chunk.ms2gallery_row.tpl',
      'content' => '<div class="span2 col-md-2">
	<a href="[[+360x270:default=`[[+url]]`]]" class="thumbnail" data-image="[[+url]]">
		<img src="[[+120x90]]" alt="[[+alt]]" title="[[+name]]" width="120" height="90">
	</a>
</div>',
    ),
  ),
  '1443906d5084d3a5f67a76828b7d17e4' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.ms2Gallery.outer',
    ),
    'object' => 
    array (
      'id' => 37,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.ms2Gallery.outer',
      'description' => '',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'snippet' => '<div class="ms2Gallery">
	<a rel="fancybox" href="[[+url:default=`/assets/ms2gallery/minishop2/img/web/ms2_big.png`]]" target="_blank">
		<img src="[[+360x270:default=`/assets/components/ms2gallery/img/web/ms2_medium.png`]]" width="360" height="270" alt="[[+alt]]" title="[[+name]]" class="mainImage" />
	</a>
	<div class="row">
		[[+rows]]
	</div>
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/chunks/chunk.ms2gallery_outer.tpl',
      'content' => '<div class="ms2Gallery">
	<a rel="fancybox" href="[[+url:default=`/assets/ms2gallery/minishop2/img/web/ms2_big.png`]]" target="_blank">
		<img src="[[+360x270:default=`/assets/components/ms2gallery/img/web/ms2_medium.png`]]" width="360" height="270" alt="[[+alt]]" title="[[+name]]" class="mainImage" />
	</a>
	<div class="row">
		[[+rows]]
	</div>
</div>',
    ),
  ),
  '3f8385680bdfbc3b0560bfc4d8dc9c34' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.ms2Gallery.empty',
    ),
    'object' => 
    array (
      'id' => 38,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.ms2Gallery.empty',
      'description' => '',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'snippet' => '<div class="ms2Gallery">
	<img src="[[++assets_url]]components/ms2gallery/img/web/ms2_medium.png" width="360" height="270" alt="no photo" title="" />
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/chunks/chunk.ms2gallery_empty.tpl',
      'content' => '<div class="ms2Gallery">
	<img src="[[++assets_url]]components/ms2gallery/img/web/ms2_medium.png" width="360" height="270" alt="no photo" title="" />
</div>',
    ),
  ),
  'b98b6a3f2ddfb6de9a01b11851ae06aa' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.ms2Gallery.single',
    ),
    'object' => 
    array (
      'id' => 39,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.ms2Gallery.single',
      'description' => '',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'snippet' => '<div class="ms2Gallery">
	<a rel="fancybox" href="[[+url:default=`/assets/ms2gallery/minishop2/img/web/ms2_big.png`]]" target="_blank">
		<img src="[[+360x270:default=`/assets/components/ms2gallery/img/web/ms2_medium.png`]]" width="360" height="270" alt="[[+alt]]" title="[[+name]]" class="mainImage" />
	</a>
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/chunks/chunk.ms2gallery_single.tpl',
      'content' => '<div class="ms2Gallery">
	<a rel="fancybox" href="[[+url:default=`/assets/ms2gallery/minishop2/img/web/ms2_big.png`]]" target="_blank">
		<img src="[[+360x270:default=`/assets/components/ms2gallery/img/web/ms2_medium.png`]]" width="360" height="270" alt="[[+alt]]" title="[[+name]]" class="mainImage" />
	</a>
</div>',
    ),
  ),
  '32f0d00066a48327a261d9e3e2d380ed' => 
  array (
    'criteria' => 
    array (
      'name' => 'ms2Gallery',
    ),
    'object' => 
    array (
      'id' => 31,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'ms2Gallery',
      'description' => '',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'snippet' => '/* @var array $scriptProperties */
/* @var ms2Gallery $ms2Gallery */
$ms2Gallery = $modx->getService(\'ms2gallery\', \'ms2Gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/ms2gallery/\');
/* @var pdoFetch $pdoFetch */
if (!$modx->loadClass(\'pdofetch\', MODX_CORE_PATH . \'components/pdotools/model/pdotools/\', false, true)) {
	return false;
}
$pdoFetch = new pdoFetch($modx, $scriptProperties);

$extensionsDir = $modx->getOption(\'extensionsDir\', $scriptProperties, \'components/ms2gallery/img/mgr/extensions/\', true);

// Register styles and scripts on frontend
$config = $ms2Gallery->makePlaceholders($ms2Gallery->config);
$css = $modx->getOption(\'frontend_css\', $scriptProperties, \'frontend_css\');
if (!empty($css) && preg_match(\'/\\.css/i\', $css)) {
	$modx->regClientCSS(str_replace($config[\'pl\'], $config[\'vl\'], $css));
}
$js = $modx->getOption(\'frontend_js\', $scriptProperties, \'frontend_js\');
if (!empty($js) && preg_match(\'/\\.js/i\', $js)) {
	$modx->regClientScript(str_replace($config[\'pl\'], $config[\'vl\'], $js));
}
if (empty($outputSeparator)) {
	$outputSeparator = "\\n";
}
if (empty($tagsSeparator)) {
	$tagsSeparator = \',\';
}

$where = array(
	\'File.parent\' => 0,
);

// Define where parameters
if ($scriptProperties[\'parents\'] == \'\' && empty($scriptProperties[\'resources\'])) {
	$resources = !empty($resource)
		? $resource
		: $modx->resource->get(\'id\');
	$scriptProperties[\'resources\'] = $resources;
}

if (!empty($filetype)) {
	$where[\'File.type:IN\'] = array_map(\'trim\', explode(\',\', $filetype));
}

if (empty($showInactive)) {
	$where[\'File.active\'] = 1;
}

$innerJoin = array(
	\'File\' => array(
		\'class\' => \'msResourceFile\',
		\'on\' => \'File.resource_id = modResource.id\',
	)
);
if (!empty($tagsVar) && isset($_REQUEST[$tagsVar])) {
	$tags = $modx->stripTags($_REQUEST[$tagsVar]);
}
if (!empty($tags)) {
	$tags = array_map(\'trim\', explode(\',\', str_replace(\'"\', \'\', $tags)));
	$tags = implode(\'","\', $tags);
	$innerJoin[\'Tag\'] = array(
		\'class\' => \'msResourceFileTag\',
		\'on\' => \'Tag.file_id = File.id AND Tag.tag IN ("\' . $tags . \'")\',
	);
}

$select = array(
	\'File\' => \'*\'
);

// Set default sort by File table
if (!empty($sortby)) {
	$sortby = array_map(\'trim\', explode(\',\', $sortby));
	foreach ($sortby as &$value) {
		if (strpos($value, \'.\') === false && strpos($value, \'(\') === false) {
			$value = \'File.\' . $value;
		}
	}
	$scriptProperties[\'sortby\'] = implode(\', \', $sortby);
}

// processing additional query params
foreach (array(\'where\', \'innerJoin\', \'select\') as $v) {
	if (!empty($scriptProperties[$v])) {
		$tmp = $modx->fromJSON($scriptProperties[$v]);
		if (is_array($tmp)) {
			$$v = array_merge($$v, $tmp);
		}
	}
	unset($scriptProperties[$v]);
}

if (empty($limit) && !empty($offset)) {
	$scriptProperties[\'limit\'] = 10000;
}

// Default parameters
$default = array(
	\'class\' => \'modResource\',
	\'innerJoin\' => $innerJoin,
	\'where\' => $modx->toJSON($where),
	\'select\' => $select,
	\'limit\' => 10,
	\'sortby\' => \'rank\',
	\'sortdir\' => \'ASC\',
	\'fastMode\' => false,
	\'groupby\' => \'File.id\',
	\'return\' => \'data\',
	\'nestedChunkPrefix\' => \'ms2gallery_\',
);

// Merge all properties and run!
$scriptProperties[\'tpl\'] = !empty($tplRow) ? $tplRow : \'\';
$pdoFetch->setConfig(array_merge($default, $scriptProperties));
$rows = $pdoFetch->run();

if (!empty($rows)) {
	$tmp = current($rows);
	$resolution = array();
	if ($mediaSource = $modx->getObject(\'sources.modMediaSource\', $tmp[\'source\'])) {
		$properties = $mediaSource->getProperties();
		if (isset($properties[\'thumbnails\'][\'value\'])) {
			$fileTypes = $modx->fromJSON($properties[\'thumbnails\'][\'value\']);
			foreach ($fileTypes as $v) {
				$resolution[] = $v[\'w\'] . \'x\' . $v[\'h\'];
			}
		}
	}
}

// Processing rows
$output = null;
$images = array();
foreach ($rows as $k => $row) {
	$row[\'idx\'] = $pdoFetch->idx++;
	$row[\'tags\'] = \'\';

	if (isset($row[\'type\']) && $row[\'type\'] == \'image\') {
		$q = $modx->newQuery(\'msResourceFile\', array(\'parent\' => $row[\'id\']));
		$q->select(\'url\');
		$tstart = microtime(true);
		if ($q->prepare() && $q->stmt->execute()) {
			$modx->queryTime += microtime(true) - $tstart;
			$modx->executedQueries++;
			while ($tmp = $q->stmt->fetchColumn()) {
				if (preg_match(\'/((?:\\d{1,4}|)x(?:\\d{1,4}|))/\', $tmp, $size)) {
					$row[$size[0]] = $tmp;
				}
			}
		}
	}
	elseif (!empty($row[\'type\'])) {
		$row[\'thumbnail\'] = file_exists(MODX_ASSETS_PATH . $extensionsDir . $row[\'type\'] . \'.png\')
			? MODX_ASSETS_URL . $extensionsDir . $row[\'type\'] . \'.png\'
			: MODX_ASSETS_URL . $extensionsDir . \'other.png\';
		foreach ($resolution as $v) {
			$row[$v] = $row[\'thumbnail\'];
		}
	}

	if (!empty($getTags)) {
		$q = $modx->newQuery(\'msResourceFileTag\', array(\'file_id\' => $row[\'id\']));
		$q->select(\'tag\');
		$tstart = microtime(true);
		if ($q->prepare() && $q->stmt->execute()) {
			$modx->queryTime += microtime(true) - $tstart;
			$modx->executedQueries++;
			$row[\'tags\'] = implode($tagsSeparator, $q->stmt->fetchAll(PDO::FETCH_COLUMN));
		}
	}

	$images[] = $row;
}
$pdoFetch->addTime(!empty($getTags) ? \'Thumbnails and tags was retrieved\' : \'Thumbnails was retrieved\');

// Processing chunks
$output = array();
foreach ($images as $row) {
	$tpl = $pdoFetch->defineChunk($row);

	$output[] = empty($tpl)
		? \'<pre>\' . $pdoFetch->getChunk(\'\', $row) . \'</pre>\'
		: $pdoFetch->getChunk($tpl, $row, $pdoFetch->config[\'fastMode\']);
}
$pdoFetch->addTime(\'Rows was templated\');

// Return output
$log = \'\';
if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$log .= \'<pre class="ms2GalleryLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
}

if (!empty($toSeparatePlaceholders)) {
	$output[\'log\'] = $log;
	$modx->setPlaceholders($output, $toSeparatePlaceholders);
}
else {
	if (count($output) === 1 && !empty($tplSingle)) {
		$output = $pdoFetch->getChunk($tplSingle, array_shift($images));
	}
	else {
		$output = implode($outputSeparator, $output);

		if (!empty($output)) {
			$arr = array_shift($images);
			$arr[\'rows\'] = $output;
			if (!empty($tplOuter)) {
				$output = $pdoFetch->getChunk($tplOuter, $arr);
			}
		}
		else {
			$output = !empty($tplEmpty)
				? $pdoFetch->getChunk($tplEmpty)
				: \'\';
		}
	}

	$output .= $log;
	if (!empty($toPlaceholder)) {
		$modx->setPlaceholder($toPlaceholder, $output);
	}
	else {
		return $output;
	}
}',
      'locked' => 0,
      'properties' => 'a:21:{s:7:"parents";a:7:{s:4:"name";s:7:"parents";s:4:"desc";s:23:"ms2gallery_prop_parents";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:9:"resources";a:7:{s:4:"name";s:9:"resources";s:4:"desc";s:25:"ms2gallery_prop_resources";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:7:"showLog";a:7:{s:4:"name";s:7:"showLog";s:4:"desc";s:23:"ms2gallery_prop_showLog";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:13:"toPlaceholder";a:7:{s:4:"name";s:13:"toPlaceholder";s:4:"desc";s:29:"ms2gallery_prop_toPlaceholder";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:6:"tplRow";a:7:{s:4:"name";s:6:"tplRow";s:4:"desc";s:22:"ms2gallery_prop_tplRow";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:18:"tpl.ms2Gallery.row";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:8:"tplOuter";a:7:{s:4:"name";s:8:"tplOuter";s:4:"desc";s:24:"ms2gallery_prop_tplOuter";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:20:"tpl.ms2Gallery.outer";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:8:"tplEmpty";a:7:{s:4:"name";s:8:"tplEmpty";s:4:"desc";s:24:"ms2gallery_prop_tplEmpty";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:20:"tpl.ms2Gallery.empty";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:9:"tplSingle";a:7:{s:4:"name";s:9:"tplSingle";s:4:"desc";s:25:"ms2gallery_prop_tplSingle";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:5:"limit";a:7:{s:4:"name";s:5:"limit";s:4:"desc";s:21:"ms2gallery_prop_limit";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:0;s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:6:"offset";a:7:{s:4:"name";s:6:"offset";s:4:"desc";s:22:"ms2gallery_prop_offset";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:0;s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:5:"where";a:7:{s:4:"name";s:5:"where";s:4:"desc";s:21:"ms2gallery_prop_where";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:8:"filetype";a:7:{s:4:"name";s:8:"filetype";s:4:"desc";s:24:"ms2gallery_prop_filetype";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:12:"showInactive";a:7:{s:4:"name";s:12:"showInactive";s:4:"desc";s:28:"ms2gallery_prop_showInactive";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:6:"sortby";a:7:{s:4:"name";s:6:"sortby";s:4:"desc";s:22:"ms2gallery_prop_sortby";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:4:"rank";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:7:"sortdir";a:7:{s:4:"name";s:7:"sortdir";s:4:"desc";s:23:"ms2gallery_prop_sortdir";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{s:4:"text";s:3:"ASC";s:5:"value";s:3:"ASC";}i:1;a:2:{s:4:"text";s:4:"DESC";s:5:"value";s:4:"DESC";}}s:5:"value";s:3:"ASC";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:12:"frontend_css";a:7:{s:4:"name";s:12:"frontend_css";s:4:"desc";s:28:"ms2gallery_prop_frontend_css";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:26:"[[+cssUrl]]web/default.css";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:11:"frontend_js";a:7:{s:4:"name";s:11:"frontend_js";s:4:"desc";s:27:"ms2gallery_prop_frontend_js";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:24:"[[+jsUrl]]web/default.js";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:4:"tags";a:7:{s:4:"name";s:4:"tags";s:4:"desc";s:20:"ms2gallery_prop_tags";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:7:"tagsVar";a:7:{s:4:"name";s:7:"tagsVar";s:4:"desc";s:23:"ms2gallery_prop_tagsVar";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:7:"getTags";a:7:{s:4:"name";s:7:"getTags";s:4:"desc";s:23:"ms2gallery_prop_getTags";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:13:"tagsSeparator";a:7:{s:4:"name";s:13:"tagsSeparator";s:4:"desc";s:29:"ms2gallery_prop_tagsSeparator";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:1:",";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}}',
      'moduleguid' => '',
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/snippets/snippet.ms2gallery.php',
      'content' => '/* @var array $scriptProperties */
/* @var ms2Gallery $ms2Gallery */
$ms2Gallery = $modx->getService(\'ms2gallery\', \'ms2Gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/ms2gallery/\');
/* @var pdoFetch $pdoFetch */
if (!$modx->loadClass(\'pdofetch\', MODX_CORE_PATH . \'components/pdotools/model/pdotools/\', false, true)) {
	return false;
}
$pdoFetch = new pdoFetch($modx, $scriptProperties);

$extensionsDir = $modx->getOption(\'extensionsDir\', $scriptProperties, \'components/ms2gallery/img/mgr/extensions/\', true);

// Register styles and scripts on frontend
$config = $ms2Gallery->makePlaceholders($ms2Gallery->config);
$css = $modx->getOption(\'frontend_css\', $scriptProperties, \'frontend_css\');
if (!empty($css) && preg_match(\'/\\.css/i\', $css)) {
	$modx->regClientCSS(str_replace($config[\'pl\'], $config[\'vl\'], $css));
}
$js = $modx->getOption(\'frontend_js\', $scriptProperties, \'frontend_js\');
if (!empty($js) && preg_match(\'/\\.js/i\', $js)) {
	$modx->regClientScript(str_replace($config[\'pl\'], $config[\'vl\'], $js));
}
if (empty($outputSeparator)) {
	$outputSeparator = "\\n";
}
if (empty($tagsSeparator)) {
	$tagsSeparator = \',\';
}

$where = array(
	\'File.parent\' => 0,
);

// Define where parameters
if ($scriptProperties[\'parents\'] == \'\' && empty($scriptProperties[\'resources\'])) {
	$resources = !empty($resource)
		? $resource
		: $modx->resource->get(\'id\');
	$scriptProperties[\'resources\'] = $resources;
}

if (!empty($filetype)) {
	$where[\'File.type:IN\'] = array_map(\'trim\', explode(\',\', $filetype));
}

if (empty($showInactive)) {
	$where[\'File.active\'] = 1;
}

$innerJoin = array(
	\'File\' => array(
		\'class\' => \'msResourceFile\',
		\'on\' => \'File.resource_id = modResource.id\',
	)
);
if (!empty($tagsVar) && isset($_REQUEST[$tagsVar])) {
	$tags = $modx->stripTags($_REQUEST[$tagsVar]);
}
if (!empty($tags)) {
	$tags = array_map(\'trim\', explode(\',\', str_replace(\'"\', \'\', $tags)));
	$tags = implode(\'","\', $tags);
	$innerJoin[\'Tag\'] = array(
		\'class\' => \'msResourceFileTag\',
		\'on\' => \'Tag.file_id = File.id AND Tag.tag IN ("\' . $tags . \'")\',
	);
}

$select = array(
	\'File\' => \'*\'
);

// Set default sort by File table
if (!empty($sortby)) {
	$sortby = array_map(\'trim\', explode(\',\', $sortby));
	foreach ($sortby as &$value) {
		if (strpos($value, \'.\') === false && strpos($value, \'(\') === false) {
			$value = \'File.\' . $value;
		}
	}
	$scriptProperties[\'sortby\'] = implode(\', \', $sortby);
}

// processing additional query params
foreach (array(\'where\', \'innerJoin\', \'select\') as $v) {
	if (!empty($scriptProperties[$v])) {
		$tmp = $modx->fromJSON($scriptProperties[$v]);
		if (is_array($tmp)) {
			$$v = array_merge($$v, $tmp);
		}
	}
	unset($scriptProperties[$v]);
}

if (empty($limit) && !empty($offset)) {
	$scriptProperties[\'limit\'] = 10000;
}

// Default parameters
$default = array(
	\'class\' => \'modResource\',
	\'innerJoin\' => $innerJoin,
	\'where\' => $modx->toJSON($where),
	\'select\' => $select,
	\'limit\' => 10,
	\'sortby\' => \'rank\',
	\'sortdir\' => \'ASC\',
	\'fastMode\' => false,
	\'groupby\' => \'File.id\',
	\'return\' => \'data\',
	\'nestedChunkPrefix\' => \'ms2gallery_\',
);

// Merge all properties and run!
$scriptProperties[\'tpl\'] = !empty($tplRow) ? $tplRow : \'\';
$pdoFetch->setConfig(array_merge($default, $scriptProperties));
$rows = $pdoFetch->run();

if (!empty($rows)) {
	$tmp = current($rows);
	$resolution = array();
	if ($mediaSource = $modx->getObject(\'sources.modMediaSource\', $tmp[\'source\'])) {
		$properties = $mediaSource->getProperties();
		if (isset($properties[\'thumbnails\'][\'value\'])) {
			$fileTypes = $modx->fromJSON($properties[\'thumbnails\'][\'value\']);
			foreach ($fileTypes as $v) {
				$resolution[] = $v[\'w\'] . \'x\' . $v[\'h\'];
			}
		}
	}
}

// Processing rows
$output = null;
$images = array();
foreach ($rows as $k => $row) {
	$row[\'idx\'] = $pdoFetch->idx++;
	$row[\'tags\'] = \'\';

	if (isset($row[\'type\']) && $row[\'type\'] == \'image\') {
		$q = $modx->newQuery(\'msResourceFile\', array(\'parent\' => $row[\'id\']));
		$q->select(\'url\');
		$tstart = microtime(true);
		if ($q->prepare() && $q->stmt->execute()) {
			$modx->queryTime += microtime(true) - $tstart;
			$modx->executedQueries++;
			while ($tmp = $q->stmt->fetchColumn()) {
				if (preg_match(\'/((?:\\d{1,4}|)x(?:\\d{1,4}|))/\', $tmp, $size)) {
					$row[$size[0]] = $tmp;
				}
			}
		}
	}
	elseif (!empty($row[\'type\'])) {
		$row[\'thumbnail\'] = file_exists(MODX_ASSETS_PATH . $extensionsDir . $row[\'type\'] . \'.png\')
			? MODX_ASSETS_URL . $extensionsDir . $row[\'type\'] . \'.png\'
			: MODX_ASSETS_URL . $extensionsDir . \'other.png\';
		foreach ($resolution as $v) {
			$row[$v] = $row[\'thumbnail\'];
		}
	}

	if (!empty($getTags)) {
		$q = $modx->newQuery(\'msResourceFileTag\', array(\'file_id\' => $row[\'id\']));
		$q->select(\'tag\');
		$tstart = microtime(true);
		if ($q->prepare() && $q->stmt->execute()) {
			$modx->queryTime += microtime(true) - $tstart;
			$modx->executedQueries++;
			$row[\'tags\'] = implode($tagsSeparator, $q->stmt->fetchAll(PDO::FETCH_COLUMN));
		}
	}

	$images[] = $row;
}
$pdoFetch->addTime(!empty($getTags) ? \'Thumbnails and tags was retrieved\' : \'Thumbnails was retrieved\');

// Processing chunks
$output = array();
foreach ($images as $row) {
	$tpl = $pdoFetch->defineChunk($row);

	$output[] = empty($tpl)
		? \'<pre>\' . $pdoFetch->getChunk(\'\', $row) . \'</pre>\'
		: $pdoFetch->getChunk($tpl, $row, $pdoFetch->config[\'fastMode\']);
}
$pdoFetch->addTime(\'Rows was templated\');

// Return output
$log = \'\';
if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$log .= \'<pre class="ms2GalleryLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
}

if (!empty($toSeparatePlaceholders)) {
	$output[\'log\'] = $log;
	$modx->setPlaceholders($output, $toSeparatePlaceholders);
}
else {
	if (count($output) === 1 && !empty($tplSingle)) {
		$output = $pdoFetch->getChunk($tplSingle, array_shift($images));
	}
	else {
		$output = implode($outputSeparator, $output);

		if (!empty($output)) {
			$arr = array_shift($images);
			$arr[\'rows\'] = $output;
			if (!empty($tplOuter)) {
				$output = $pdoFetch->getChunk($tplOuter, $arr);
			}
		}
		else {
			$output = !empty($tplEmpty)
				? $pdoFetch->getChunk($tplEmpty)
				: \'\';
		}
	}

	$output .= $log;
	if (!empty($toPlaceholder)) {
		$modx->setPlaceholder($toPlaceholder, $output);
	}
	else {
		return $output;
	}
}',
    ),
  ),
  'e65d1bbfea5b561feabb06bc028d7e34' => 
  array (
    'criteria' => 
    array (
      'name' => 'ms2GalleryResources',
    ),
    'object' => 
    array (
      'id' => 32,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'ms2GalleryResources',
      'description' => '',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'snippet' => '/** @var array $scriptProperties */
$class = \'modResource\';

// Load model
if (empty($loadModels)) {
	$scriptProperties[\'loadModels\'] = \'ms2Gallery\';
} else {
	$loadModels = array_map(\'trim\', explode(\',\', $loadModels));
	if (!in_array(\'ms2gallery\', $loadModels)) {
		$loadModels[] = \'ms2gallery\';
	}
	$scriptProperties[\'loadModels\'] = $loadModels;
}

// Type of join
if (empty($typeOfJoin)) {
	$typeOfJoin = \'left\';
}
switch (strtolower(trim($typeOfJoin))) {
	case \'right\':
		$join = \'rightJoin\';
		break;
	case \'inner\':
		$join = \'innerJoin\';
		break;
	default:
		$join = \'leftJoin\';
		break;
}

// Select modResource
$columns = array_keys($modx->getFieldMeta($class));
if (empty($includeContent) && empty($useWeblinkUrl)) {
	$key = array_search(\'content\', $columns);
	unset($columns[$key]);
}
$select = array(
	$class => implode(\',\', $columns)
);

// Include Thumbnails
${$join} = array();
if (empty($includeThumbs)) {
	$includeThumbs = \'120x90\';
}
$thumbs = array_map(\'trim\', explode(\',\', $includeThumbs));
if (!empty($thumbs[0])) {
	foreach ($thumbs as $thumb) {
		${$join}[] = array(
			\'class\' => \'msResourceFile\',
			\'alias\' => $thumb,
			\'on\' => preg_replace(\'/(\\n|\\t)/\', \'\', "
				`$thumb`.`resource_id` = `$class`.`id` AND
				`$thumb`.`parent` != 0 AND
				`$thumb`.`path` LIKE \'%/$thumb/\' AND
				`$thumb`.`active` = 1 AND
				`$thumb`.`rank` = 0
			")
		);
		$select[$thumb] = preg_replace(\'/(\\n|\\t)/\', \'\', "
			`$thumb`.`url` as `$thumb`,
			`$thumb`.`name` as `$thumb.name`,
			`$thumb`.`description` as `$thumb.description`,
			`$thumb`.`createdon` as `$thumb.createdon`,
			`$thumb`.`createdby` as `$thumb.createdby`,
			`$thumb`.`properties` as `$thumb.properties`,
			`$thumb`.`alt` as `$thumb.alt`,
			`$thumb`.`add` as `$thumb.add`
		");

		if (!empty($includeOriginal)) {
			${$join}[] = array(
				\'class\' => \'msResourceFile\',
				\'alias\' => $thumb.\'o\',
				\'on\' => preg_replace(\'/(\\n|\\t)/\', \'\', "
					`{$thumb}o`.`resource_id` = `$class`.`id` AND
					`{$thumb}o`.`parent` = 0 AND
					`{$thumb}o`.`active` = 1 AND
					`{$thumb}o`.`rank` = 0
				")
			);
			$select[$thumb] .= ", `{$thumb}o`.`url` as `$thumb.original`";
		}
	}
}

foreach (array(\'leftJoin\', \'innerJoin\', \'rightJoin\', \'select\') as $v) {
	if (!empty($scriptProperties[$v])) {
		$tmp = $modx->fromJSON($scriptProperties[$v]);
		if (is_array($tmp)) {
			$$v = array_merge($$v, $tmp);
		}
	}
	unset($scriptProperties[$v]);
}
$scriptProperties[\'select\'] = $modx->toJSON($select);
$scriptProperties[\'groupby\'] = $class . \'.id\';
$scriptProperties[$join] = $modx->toJSON(${$join});

return $modx->runSnippet(\'pdoResources\', $scriptProperties);',
      'locked' => 0,
      'properties' => 'a:3:{s:10:"typeOfJoin";a:7:{s:4:"name";s:10:"typeOfJoin";s:4:"desc";s:26:"ms2gallery_prop_typeOfJoin";s:4:"type";s:4:"list";s:7:"options";a:2:{i:0;a:2:{s:4:"text";s:4:"left";s:5:"value";s:4:"left";}i:1;a:2:{s:4:"text";s:5:"inner";s:5:"value";s:5:"inner";}}s:5:"value";s:4:"left";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:13:"includeThumbs";a:7:{s:4:"name";s:13:"includeThumbs";s:4:"desc";s:29:"ms2gallery_prop_includeThumbs";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:6:"120x90";s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}s:15:"includeOriginal";a:7:{s:4:"name";s:15:"includeOriginal";s:4:"desc";s:31:"ms2gallery_prop_includeOriginal";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:21:"ms2gallery:properties";s:4:"area";s:0:"";}}',
      'moduleguid' => '',
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/snippets/snippet.ms2gallery_resources.php',
      'content' => '/** @var array $scriptProperties */
$class = \'modResource\';

// Load model
if (empty($loadModels)) {
	$scriptProperties[\'loadModels\'] = \'ms2Gallery\';
} else {
	$loadModels = array_map(\'trim\', explode(\',\', $loadModels));
	if (!in_array(\'ms2gallery\', $loadModels)) {
		$loadModels[] = \'ms2gallery\';
	}
	$scriptProperties[\'loadModels\'] = $loadModels;
}

// Type of join
if (empty($typeOfJoin)) {
	$typeOfJoin = \'left\';
}
switch (strtolower(trim($typeOfJoin))) {
	case \'right\':
		$join = \'rightJoin\';
		break;
	case \'inner\':
		$join = \'innerJoin\';
		break;
	default:
		$join = \'leftJoin\';
		break;
}

// Select modResource
$columns = array_keys($modx->getFieldMeta($class));
if (empty($includeContent) && empty($useWeblinkUrl)) {
	$key = array_search(\'content\', $columns);
	unset($columns[$key]);
}
$select = array(
	$class => implode(\',\', $columns)
);

// Include Thumbnails
${$join} = array();
if (empty($includeThumbs)) {
	$includeThumbs = \'120x90\';
}
$thumbs = array_map(\'trim\', explode(\',\', $includeThumbs));
if (!empty($thumbs[0])) {
	foreach ($thumbs as $thumb) {
		${$join}[] = array(
			\'class\' => \'msResourceFile\',
			\'alias\' => $thumb,
			\'on\' => preg_replace(\'/(\\n|\\t)/\', \'\', "
				`$thumb`.`resource_id` = `$class`.`id` AND
				`$thumb`.`parent` != 0 AND
				`$thumb`.`path` LIKE \'%/$thumb/\' AND
				`$thumb`.`active` = 1 AND
				`$thumb`.`rank` = 0
			")
		);
		$select[$thumb] = preg_replace(\'/(\\n|\\t)/\', \'\', "
			`$thumb`.`url` as `$thumb`,
			`$thumb`.`name` as `$thumb.name`,
			`$thumb`.`description` as `$thumb.description`,
			`$thumb`.`createdon` as `$thumb.createdon`,
			`$thumb`.`createdby` as `$thumb.createdby`,
			`$thumb`.`properties` as `$thumb.properties`,
			`$thumb`.`alt` as `$thumb.alt`,
			`$thumb`.`add` as `$thumb.add`
		");

		if (!empty($includeOriginal)) {
			${$join}[] = array(
				\'class\' => \'msResourceFile\',
				\'alias\' => $thumb.\'o\',
				\'on\' => preg_replace(\'/(\\n|\\t)/\', \'\', "
					`{$thumb}o`.`resource_id` = `$class`.`id` AND
					`{$thumb}o`.`parent` = 0 AND
					`{$thumb}o`.`active` = 1 AND
					`{$thumb}o`.`rank` = 0
				")
			);
			$select[$thumb] .= ", `{$thumb}o`.`url` as `$thumb.original`";
		}
	}
}

foreach (array(\'leftJoin\', \'innerJoin\', \'rightJoin\', \'select\') as $v) {
	if (!empty($scriptProperties[$v])) {
		$tmp = $modx->fromJSON($scriptProperties[$v]);
		if (is_array($tmp)) {
			$$v = array_merge($$v, $tmp);
		}
	}
	unset($scriptProperties[$v]);
}
$scriptProperties[\'select\'] = $modx->toJSON($select);
$scriptProperties[\'groupby\'] = $class . \'.id\';
$scriptProperties[$join] = $modx->toJSON(${$join});

return $modx->runSnippet(\'pdoResources\', $scriptProperties);',
    ),
  ),
  '5d0f9a38e5fb284527cfceeea85b9326' => 
  array (
    'criteria' => 
    array (
      'name' => 'ms2Gallery',
    ),
    'object' => 
    array (
      'id' => 8,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'ms2Gallery',
      'description' => 'Main plugin for ms2Gallery',
      'editor_type' => 0,
      'category' => 10,
      'cache_type' => 0,
      'plugincode' => '/** @var array $scriptProperties */
switch ($modx->event->name) {

	case \'OnDocFormRender\':
		/** @var modResource $resource */
		if ($mode == \'new\' || ($resource->class_key == \'msProduct\' && $modx->getOption(\'ms2gallery_disable_for_ms2\', null, true))) {
			return;
		}
		$template = $resource->get(\'template\');
		$templates = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_disable_for_templates\')));
		if ($templates[0] != \'\' && in_array($template, $templates)) {
			return;
		}

		/** @var ms2Gallery $ms2Gallery */
		if ($ms2Gallery = $modx->getService(\'ms2gallery\', \'ms2Gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/ms2gallery/\')) {
			$ms2Gallery->loadManagerFiles($modx->controller, $resource);
		}
		break;


	case \'OnBeforeDocFormSave\':
		if ($source_id = $resource->get(\'media_source\')) {
			$resource->setProperties(array(\'media_source\' => $source_id), \'ms2gallery\');
		}
		break;


	case \'OnLoadWebDocument\':
		$tstart = microtime(true);
		/** @var pdoFetch $pdoFetch */
		if (!$modx->getOption(\'ms2gallery_set_placeholders\', null, false, true) || !$pdoFetch = $modx->getService(\'pdoFetch\')) {
			return;
		}
		$plTemplates = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_placeholders_for_templates\')));
		if (!empty($plTemplates[0]) && !in_array($modx->resource->get(\'template\'), $plTemplates)) {
			return;
		}
		$plPrefix = $modx->getOption(\'ms2gallery_placeholders_prefix\', null, \'ms2g.\', true);
		$plThumbs = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_placeholders_thumbs\')));
		$tplName = $modx->getOption(\'ms2gallery_placeholders_tpl\');

		// Check for assigned TV
		$q = $modx->newQuery(\'modTemplateVarTemplate\');
		$q->innerJoin(\'modTemplateVar\', \'TemplateVar\');
		$q->innerJoin(\'modTemplate\', \'Template\');
		$q->where(array(
			\'TemplateVar.name\' => $tplName,
			\'Template.id\' => $modx->resource->get(\'template\')
		));
		$q->select(\'TemplateVar.id\');

		$tpl = \'\';
		if ($modx->getCount(\'modTemplateVarTemplate\', $q)) {
			$tpl = $modx->resource->getTVValue($tplName);
		}
		/** @var modChunk $chunk */
		if (empty($tpl) && $chunk = $modx->getObject(\'modChunk\', array(\'name\' => $tplName))) {
			$tpl = $chunk->getContent();
		}

		$options = array(\'loadModels\' => \'ms2gallery\');
		$where = array(\'resource_id\' => $modx->resource->id, \'parent\' => 0);

		$parents = $pdoFetch->getCollection(\'msResourceFile\', $where, $options);
		$options[\'select\'] = \'url\';
		foreach ($parents as &$parent) {
			$where = array(\'parent\' => $parent[\'id\']);
			if (!empty($plThumbs[0])) {
				$where[\'path:IN\'] = array();
				foreach ($plThumbs as $thumb) {
					$where[\'path:IN\'][] = $parent[\'path\'] . $thumb . \'/\';
				}
			}
			if ($children = $pdoFetch->getCollection(\'msResourceFile\', $where, $options)) {
				foreach ($children as $child) {
					if (preg_match(\'/((?:\\d{1,4}|)x(?:\\d{1,4}|))/\', $child[\'url\'], $size)) {
						$parent[$size[0]] = $child[\'url\'];
					}
				}
			}
			$pls = $pdoFetch->makePlaceholders($parent, $plPrefix . $parent[\'rank\'] . \'.\', \'[[+\', \']]\', false);
			$pls[\'vl\'][$plPrefix . $parent[\'rank\']] = !empty($tpl)
				? $pdoFetch->getChunk(\'@INLINE \' . $tpl, $parent)
				: htmlentities(print_r($parent, 1), ENT_QUOTES, \'UTF-8\');
			$modx->setPlaceholders($pls[\'vl\']);
		}

		$modx->log(modX::LOG_LEVEL_INFO, \'[ms2Gallery] Set image placeholders for page id = \' . $modx->resource->id . \' in \' . number_format(microtime(true) - $tstart, 7) . \' sec.\');
		break;


	case \'OnBeforeEmptyTrash\':
		if (empty($scriptProperties[\'ids\']) || !is_array($scriptProperties[\'ids\'])) {
			return;
		}
		if (!$modx->addPackage(\'ms2gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/\')) {
			return;
		}
		$resources = $modx->getIterator(\'modResource\', array(\'id:IN\' => $scriptProperties[\'ids\']));
		/** @var modResource $resource */
		foreach ($resources as $resource) {
			$properties = $resource->getProperties(\'ms2gallery\');
			if (!empty($properties[\'media_source\'])) {
				/** @var modMediaSource $source */
				$source = $modx->getObject(\'modMediaSource\', $properties[\'media_source\']);
				$resource_id = $resource->get(\'id\');
				if ($source) {
					$source->set(\'ctx\', $resource->get(\'context_key\'));
					$source->initialize();
				}
				$images = $modx->getIterator(\'msResourceFile\', array(\'resource_id\' => $resource_id, \'parent\' => 0));
				/** @var msResourceFile $image */
				foreach ($images as $image) {
					$prepare = $image->prepareSource($source);
					if ($prepare === true) {
						$image->remove();
					}
					else {
						$modx->log(modX::LOG_LEVEL_ERROR, "[ms2Gallery] {$prepare}.");
					}
				}
				if ($source) {
					$source->removeContainer($source->getBasePath() . $resource_id);
				}
			}
		}
		break;

}',
      'locked' => 0,
      'properties' => NULL,
      'disabled' => 0,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => 'core/components/ms2gallery/elements/plugins/plugin.ms2gallery.php',
      'content' => '/** @var array $scriptProperties */
switch ($modx->event->name) {

	case \'OnDocFormRender\':
		/** @var modResource $resource */
		if ($mode == \'new\' || ($resource->class_key == \'msProduct\' && $modx->getOption(\'ms2gallery_disable_for_ms2\', null, true))) {
			return;
		}
		$template = $resource->get(\'template\');
		$templates = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_disable_for_templates\')));
		if ($templates[0] != \'\' && in_array($template, $templates)) {
			return;
		}

		/** @var ms2Gallery $ms2Gallery */
		if ($ms2Gallery = $modx->getService(\'ms2gallery\', \'ms2Gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/ms2gallery/\')) {
			$ms2Gallery->loadManagerFiles($modx->controller, $resource);
		}
		break;


	case \'OnBeforeDocFormSave\':
		if ($source_id = $resource->get(\'media_source\')) {
			$resource->setProperties(array(\'media_source\' => $source_id), \'ms2gallery\');
		}
		break;


	case \'OnLoadWebDocument\':
		$tstart = microtime(true);
		/** @var pdoFetch $pdoFetch */
		if (!$modx->getOption(\'ms2gallery_set_placeholders\', null, false, true) || !$pdoFetch = $modx->getService(\'pdoFetch\')) {
			return;
		}
		$plTemplates = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_placeholders_for_templates\')));
		if (!empty($plTemplates[0]) && !in_array($modx->resource->get(\'template\'), $plTemplates)) {
			return;
		}
		$plPrefix = $modx->getOption(\'ms2gallery_placeholders_prefix\', null, \'ms2g.\', true);
		$plThumbs = array_map(\'trim\', explode(\',\', $modx->getOption(\'ms2gallery_placeholders_thumbs\')));
		$tplName = $modx->getOption(\'ms2gallery_placeholders_tpl\');

		// Check for assigned TV
		$q = $modx->newQuery(\'modTemplateVarTemplate\');
		$q->innerJoin(\'modTemplateVar\', \'TemplateVar\');
		$q->innerJoin(\'modTemplate\', \'Template\');
		$q->where(array(
			\'TemplateVar.name\' => $tplName,
			\'Template.id\' => $modx->resource->get(\'template\')
		));
		$q->select(\'TemplateVar.id\');

		$tpl = \'\';
		if ($modx->getCount(\'modTemplateVarTemplate\', $q)) {
			$tpl = $modx->resource->getTVValue($tplName);
		}
		/** @var modChunk $chunk */
		if (empty($tpl) && $chunk = $modx->getObject(\'modChunk\', array(\'name\' => $tplName))) {
			$tpl = $chunk->getContent();
		}

		$options = array(\'loadModels\' => \'ms2gallery\');
		$where = array(\'resource_id\' => $modx->resource->id, \'parent\' => 0);

		$parents = $pdoFetch->getCollection(\'msResourceFile\', $where, $options);
		$options[\'select\'] = \'url\';
		foreach ($parents as &$parent) {
			$where = array(\'parent\' => $parent[\'id\']);
			if (!empty($plThumbs[0])) {
				$where[\'path:IN\'] = array();
				foreach ($plThumbs as $thumb) {
					$where[\'path:IN\'][] = $parent[\'path\'] . $thumb . \'/\';
				}
			}
			if ($children = $pdoFetch->getCollection(\'msResourceFile\', $where, $options)) {
				foreach ($children as $child) {
					if (preg_match(\'/((?:\\d{1,4}|)x(?:\\d{1,4}|))/\', $child[\'url\'], $size)) {
						$parent[$size[0]] = $child[\'url\'];
					}
				}
			}
			$pls = $pdoFetch->makePlaceholders($parent, $plPrefix . $parent[\'rank\'] . \'.\', \'[[+\', \']]\', false);
			$pls[\'vl\'][$plPrefix . $parent[\'rank\']] = !empty($tpl)
				? $pdoFetch->getChunk(\'@INLINE \' . $tpl, $parent)
				: htmlentities(print_r($parent, 1), ENT_QUOTES, \'UTF-8\');
			$modx->setPlaceholders($pls[\'vl\']);
		}

		$modx->log(modX::LOG_LEVEL_INFO, \'[ms2Gallery] Set image placeholders for page id = \' . $modx->resource->id . \' in \' . number_format(microtime(true) - $tstart, 7) . \' sec.\');
		break;


	case \'OnBeforeEmptyTrash\':
		if (empty($scriptProperties[\'ids\']) || !is_array($scriptProperties[\'ids\'])) {
			return;
		}
		if (!$modx->addPackage(\'ms2gallery\', MODX_CORE_PATH . \'components/ms2gallery/model/\')) {
			return;
		}
		$resources = $modx->getIterator(\'modResource\', array(\'id:IN\' => $scriptProperties[\'ids\']));
		/** @var modResource $resource */
		foreach ($resources as $resource) {
			$properties = $resource->getProperties(\'ms2gallery\');
			if (!empty($properties[\'media_source\'])) {
				/** @var modMediaSource $source */
				$source = $modx->getObject(\'modMediaSource\', $properties[\'media_source\']);
				$resource_id = $resource->get(\'id\');
				if ($source) {
					$source->set(\'ctx\', $resource->get(\'context_key\'));
					$source->initialize();
				}
				$images = $modx->getIterator(\'msResourceFile\', array(\'resource_id\' => $resource_id, \'parent\' => 0));
				/** @var msResourceFile $image */
				foreach ($images as $image) {
					$prepare = $image->prepareSource($source);
					if ($prepare === true) {
						$image->remove();
					}
					else {
						$modx->log(modX::LOG_LEVEL_ERROR, "[ms2Gallery] {$prepare}.");
					}
				}
				if ($source) {
					$source->removeContainer($source->getBasePath() . $resource_id);
				}
			}
		}
		break;

}',
    ),
  ),
  '556e2bb7b89947245df93bb60e34e1ff' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnDocFormRender',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnDocFormRender',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '4d9bfba378fc606ded7b5c171c6dd2f4' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnLoadWebDocument',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnLoadWebDocument',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '23cb88c67dd7f37d64fab6cd3e74fa6a' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnBeforeDocFormSave',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnBeforeDocFormSave',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '8a4fb05ae584b6b6f2db1dc0163d6290' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnBeforeEmptyTrash',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnBeforeEmptyTrash',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
);